<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NBA Higher or Lower (2K Ratings)</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <button onclick="window.location.href='start.html'">Back to Start</button>
    <h1>NBA Higher or Lower (2K Ratings)</h1>
    <h2>Select Who Has The Higher 2K Rating</h2>

    <!-- Scoreboard and game area -->
    <div id="scoreboard">
      <p>Current Score: <span id="current-score">0</span></p>
      <p>High Score: <span id="high-score">0</span></p>
    </div>
    <div id="game">
      <div id="player1"></div>
      <div id="player2"></div>
    </div>

    <script>
      // Initialize current score and the high score
      let currentScore = 0;
      let highScore = localStorage.getItem("highScore2K") || 0;
      document.getElementById("high-score").textContent = highScore;

      // Function to fetch two random players from the database
      async function fetchPlayers() {
        try {
          const response = await fetch("http://localhost:5000/players/random");
          const players = await response.json();

          const player1 = players[0];
          const player2 = players[1];

          // Update the HTML for player1 and player2
          document.getElementById("player1").innerHTML = `
            <h2>${player1.player_name}</h2>
            <img src="${player1.image_url}" alt="${player1.player_name}" width="200">
            <button onclick="checkWinner(${player1.rating}, ${player2.rating}, 1)">Select</button>
          `;

          document.getElementById("player2").innerHTML = `
            <h2>${player2.player_name}</h2>
            <img src="${player2.image_url}" alt="${player2.player_name}" width="200">
            <button onclick="checkWinner(${player1.rating}, ${player2.rating}, 2)">Select</button>
          `;

          // Remove any previous classes
          document
            .getElementById("player1")
            .classList.remove("correct", "wrong");
          document
            .getElementById("player2")
            .classList.remove("correct", "wrong");
        } catch (error) {
          console.error("Error fetching players:", error);
        }
      }

      // Function to check if selected player had higher rating and if its correct
      function checkWinner(rating1, rating2, selected) {
        const player1Div = document.getElementById("player1");
        const player2Div = document.getElementById("player2");
        if (
          (selected === 1 && rating1 > rating2) ||
          (selected === 2 && rating2 > rating1)
        ) {
          // Increment current score and update high score if needed
          currentScore++;
          document.getElementById("current-score").textContent = currentScore;
          if (currentScore > highScore) {
            highScore = currentScore;
            localStorage.setItem("highScore2K", highScore);
            document.getElementById("high-score").textContent = highScore;
          }

          // Add correct class to selected player
          if (selected === 1) {
            player1Div.classList.add("correct");
          } else {
            player2Div.classList.add("correct");
          }
        } else {
          // Reset score and add wrong class to the selected player
          currentScore = 0;
          document.getElementById("current-score").textContent = currentScore;
          if (selected === 1) {
            player1Div.classList.add("wrong");
          } else {
            player2Div.classList.add("wrong");
          }
        }

        // Fetch new players after a short delay to show the effect
        setTimeout(fetchPlayers, 800);
      }

      // Fetch initial players when the page loads
      fetchPlayers();
    </script>
  </body>
</html>
